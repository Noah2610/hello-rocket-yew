#!/bin/bash

# shellcheck source=./share.sh
_dir="$( dirname "$0" )"
source "${_dir}/share.sh"
unset _dir

check "cargo-watch"
check_dir "$BACKEND"
check_dir "$FRONTEND"

# Watch and recompile backend crate
function watch_backend {
  cargo watch                   \
    -w "${BACKEND}/src"         \
    -w "${BACKEND}/Cargo.toml"  \
    -w "${BACKEND}/Rocket.toml" \
    -x "run --bin $BACKEND_BIN $CARGO_ARGS"
}

# Watch and recompile frontend crate
function watch_frontend {
  cargo watch                   \
    -w "${FRONTEND}/src"        \
    -w "${FRONTEND}/Cargo.toml" \
    -s "${ROOT}/bin/build-frontend"
}

watch_frontend &
watch_backend
